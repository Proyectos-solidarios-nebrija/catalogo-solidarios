---
import BlogLayout from '@layouts/BlogLayout.astro'
import PartnerCompanies from '@components/PartnerCompanies.astro'
import { getProjects } from 'src/services/cms'
import type { PartnerCompaniesData, PhotoData } from 'src/types/types'
import { languages } from 'src/i18n/ui'

interface Props {
  name: string
  date_start: string
  date_end: string
  article_html: string
  project_image: PhotoData
  web_link: string
  partner_companies: PartnerCompaniesData[]
}

export async function getStaticPaths() {
  const { docs: projects } = await getProjects(languages.en)

  const paths = projects.map((project) => ({
    params: { slug: project.slug },
    props: project
  }))

  return paths
}

const {
  name,
  date_start,
  date_end,
  article_html,
  project_image,
  web_link,
  partner_companies
} = Astro.props

const companies = partner_companies.map(
  ({ partner_company }) => partner_company
)
---

<BlogLayout
  title={name}
  dateStart={new Date(date_start)}
  dateEnd={new Date(date_end)}
  webLink={web_link}
  img={{
    url: project_image.url,
    width: project_image.width,
    height: project_image.height,
    alt: project_image.alt
  }}>
  <Fragment set:html={article_html} />
  {companies.length > 0 && <PartnerCompanies companies={companies} />}
</BlogLayout>
