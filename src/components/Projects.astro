---
import {
  getLangFromUrl,
  useTranslatedPath,
  useTranslations
} from 'src/i18n/utils'
import Project from './Project.astro'
import { getCollection } from 'astro:content'

const currentLang = getLangFromUrl(Astro.url)
const t = useTranslations(currentLang)
const translatePath = useTranslatedPath(currentLang)

const projects = await getCollection('proyectos', ({ id }) =>
  id.startsWith(`${currentLang}/`)
)

projects.sort((a, b) => b.data.yearStart - a.data.yearStart) // Sort in descending order
---

<main>
  <h2 id={t('nav.projects')}>{t('nav.projects')}</h2>
  <ol>
    {
      projects.map(({ data, slug }, idx) => (
        <Project
          yearStart={data.yearStart}
          yearEnd={data.yearEnd}
          title={data.title}
          imgPath={data.imgPath}
          isLastProject={idx === 0}
          articleLink={`${translatePath('/proyectos')}/${slug.split('/')[1]}`}
        />
      ))
    }
  </ol>
</main>

<style>
  h2 {
    font-size: 8rem;
    font-weight: 400;
    text-align: center;
    margin: 0;
  }

  ol {
    padding: 0;
    margin-top: 100px;
    display: flex;
    flex-direction: column;
  }

  main {
    margin-top: 150px;
  }

  @media (width <= 1200px) {
    ol {
      gap: 100px;
    }
  }
</style>
