---
import {
  getLangFromUrl,
  useTranslatedPath,
  useTranslations
} from 'src/i18n/utils'
import Project from './Project.astro'
import { getProjects } from 'src/services/cms'
import { getEnv } from 'src/helpers/getEnv'

const currentLang = getLangFromUrl(Astro.url)
const t = useTranslations(currentLang)
const translatePath = useTranslatedPath(currentLang)

const { CMS_URL } = getEnv()

const { docs: projects } = await getProjects()

projects.sort(
  (a, b) => new Date(b.date_start).getTime() - new Date(a.date_start).getTime()
) // Sort in descending order
---

<main>
  <h2 id={t('nav.projects')}>{t('nav.projects')}</h2>
  <ol>
    {
      projects.map(({ name, date_start, date_end, project_image }, idx) => (
        <Project
          yearStart={new Date(date_start)}
          yearEnd={new Date(date_end)}
          title={name}
          img={{
            src: CMS_URL + project_image.url,
            heigth: project_image.height,
            width: project_image.width
          }}
          isLastProject={idx === 0}
          articleLink={`${translatePath('/proyectos')}/${name}`}
        />
      ))
    }
  </ol>
</main>

<style>
  h2 {
    font-size: 8rem;
    font-weight: 400;
    text-align: center;
    margin: 0;
  }

  ol {
    padding: 0;
    margin-top: 100px;
    display: flex;
    flex-direction: column;
  }

  main {
    margin-top: 150px;
  }

  @media (width <= 1200px) {
    ol {
      gap: 100px;
    }
  }
</style>
